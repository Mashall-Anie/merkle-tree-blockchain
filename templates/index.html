<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merkle Tree - B√†i T·∫≠p L·ªõn Blockchain</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="container">
        <header>
            <h1>üå≤ Merkle Tree - Ki·ªÉm Tra T√≠nh To√†n V·∫πn D·ªØ Li·ªáu</h1>
            <p class="subtitle">B√†i T·∫≠p L·ªõn Blockchain - C√¥ng C·ª• Demo & Ki·ªÉm Tra</p>
        </header>

        <div class="grid">
            <div class="card">
                <h2>X√¢y D·ª±ng Merkle Tree</h2>

                <div class="form-group">
                    <label>Nh·∫≠p d·ªØ li·ªáu (m·ªói d√≤ng 1 ph·∫ßn t·ª≠):</label>
                    <textarea id="dataInput" rows="6" placeholder="Block 1&#10;Block 2&#10;Block 3&#10;Block 4"
                        oninput="updateLineCounter()"></textarea>
                    <div class="line-counter" id="lineCounter">
                        <span id="lineCount">0</span> / 200 d√≤ng
                    </div>
                </div>

                <div class="example-data">
                    <button class="example-btn" onclick="loadExample(1)">üìù V√≠ d·ª• 1: 4 Blocks</button>
                    <button class="example-btn" onclick="loadExample(2)">üìù V√≠ d·ª• 2: 5 Blocks</button>
                    <button class="example-btn" onclick="loadExample(3)">üìù V√≠ d·ª• 3: Transactions</button>
                </div>

                <div class="button-group">
                    <button class="btn-primary" onclick="buildTree()" id="buildBtn">üî® X√¢y D·ª±ng Tree</button>
                    <button class="btn-secondary" onclick="clearAll()">üóëÔ∏è X√≥a</button>
                </div>

                <div id="buildStatus"></div>
            </div>

            <div class="card">
                <h2>‚úÖ Root Hash (T√≥m T·∫Øt D·ªØ Li·ªáu)</h2>

                <p style="color: var(--color-text-secondary); font-size: 13px; margin-bottom: 10px;">
                    Root hash l√† ƒë·∫°i di·ªán duy nh·∫•t cho to√†n b·ªô d·ªØ li·ªáu. N·∫øu 1 ph·∫ßn t·ª≠ thay ƒë·ªïi ‚Üí root hash s·∫Ω kh√°c.
                </p>

                <div class="hash-display" id="rootHashDisplay">
                    Ch∆∞a x√¢y d·ª±ng tree
                </div>

                <button class="btn-primary" onclick="copyToClipboard('rootHashDisplay')"
                    style="width: 100%; margin-top: 10px;">
                    üìã Copy Root Hash
                </button>
            </div>
        </div>

        <div class="card">
            <h2>üå≥ C·∫•u Tr√∫c Merkle Tree</h2>

            <p style="color: var(--color-text-secondary); font-size: 13px; margin-bottom: 10px;">
                C√¢y ƒë∆∞·ª£c x√¢y d·ª±ng t·ª´ d∆∞·ªõi l√™n (leaf ‚Üí root). M·ªói node l√† SHA-256 hash c·ªßa 2 node con.
            </p>

            <div class="tree-visual-container" id="treeVisualContainer">
                <div class="tree-visual" id="treeVisual">
                    <div class="tree-placeholder">Ch∆∞a x√¢y d·ª±ng tree</div>
                </div>
            </div>

            <div class="tree-structure-toggle">
                <button class="btn-secondary" onclick="toggleTextStructure()" style="width: 100%; margin-top: 10px;">
                    üìÑ Hi·ªÉn th·ªã/·∫®n C·∫•u Tr√∫c Text
                </button>
            </div>

            <div class="tree-structure" id="treeStructure" style="display: none; margin-top: 10px;">
                Ch∆∞a x√¢y d·ª±ng tree
            </div>

            <button class="btn-secondary" onclick="downloadTreeStructure()" style="width: 100%; margin-top: 10px;">
                üì• Download C·∫•u Tr√∫c
            </button>
        </div>

        <div class="card">
            <h2>üîê Merkle Proof - Ch·ª©ng Minh D·ªØ Li·ªáu H·ª£p L·ªá</h2>

            <p style="color: var(--color-text-secondary); font-size: 13px; margin-bottom: 10px;">
                Merkle Proof cho ph√©p b·∫°n ch·ª©ng minh 1 ph·∫ßn t·ª≠ n·∫±m trong tree m√† kh√¥ng c·∫ßn to√†n b·ªô d·ªØ li·ªáu.
            </p>

            <div class="form-group">
                <label>Ch·ªçn ph·∫ßn t·ª≠ c·∫ßn ch·ª©ng minh:</label>
                <select id="proofSelect" class="data-select">
                    <option value="" disabled selected>-- Vui l√≤ng x√¢y d·ª±ng tree tr∆∞·ªõc --</option>
                </select>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="generateProof()">üîë Sinh Proof</button>
                <button class="btn-secondary" onclick="clearProof()">üóëÔ∏è X√≥a Proof</button>
            </div>

            <div id="proofStatus"></div>

            <div id="proofOutput" style="display: none;">
                <div style="margin-top: 15px; border-top: 1px solid var(--color-border); padding-top: 15px;">
                    <p style="color: var(--color-text-secondary); font-size: 12px; margin-bottom: 10px;">
                        <span class="legend-item"><span class="legend-color legend-target"></span> Ph·∫ßn t·ª≠ ƒë∆∞·ª£c
                            ch·ªçn</span>
                        <span class="legend-item"><span class="legend-color legend-proof"></span> Nodes trong proof
                            path</span>
                        <span class="legend-item"><span class="legend-color legend-computed"></span> Nodes ƒë∆∞·ª£c t√≠nh
                            to√°n</span>
                    </p>
                    <div class="tree-visual-container" id="proofTreeContainer" style="max-height: 350px;">
                        <div class="tree-visual" id="proofTreeVisual"></div>
                    </div>
                </div>

                <div style="margin-top: 15px; border-top: 1px solid var(--color-border); padding-top: 15px;">
                    <h3 style="font-size: 14px; margin-bottom: 10px;">üìú Merkle Proof Path:</h3>
                    <div id="proofPath"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>‚úîÔ∏è Ki·ªÉm Tra Merkle Proof</h2>

            <p style="color: var(--color-text-secondary); font-size: 13px; margin-bottom: 10px;">
                Ki·ªÉm tra xem proof c√≥ h·ª£p l·ªá kh√¥ng b·∫±ng c√°ch t√≠nh l·∫°i root hash t·ª´ leaf + proof.
            </p>

            <div class="form-group">
                <label>Ch·ªçn ho·∫∑c nh·∫≠p d·ªØ li·ªáu c·∫ßn ki·ªÉm tra:</label>
                <div class="verify-input-group">
                    <select id="verifySelect" class="data-select verify-select" onchange="onVerifySelectChange()">
                        <option value="" disabled selected>-- Ch·ªçn t·ª´ danh s√°ch --</option>
                    </select>
                    <span class="verify-or">ho·∫∑c</span>
                    <div class="verify-search-wrapper">
                        <input type="text" id="verifyInput" class="verify-input"
                            placeholder="Nh·∫≠p b·∫•t k·ª≥ d·ªØ li·ªáu n√†o..." oninput="onVerifyInputChange()">
                        <div class="verify-search-results" id="verifySearchResults" style="display: none;"></div>
                    </div>
                </div>
                <p style="color: var(--color-text-secondary); font-size: 11px; margin-top: 6px;">
                    üí° B·∫°n c√≥ th·ªÉ ch·ªçn t·ª´ danh s√°ch ho·∫∑c nh·∫≠p b·∫•t k·ª≥ d·ªØ li·ªáu n√†o ƒë·ªÉ ki·ªÉm tra (k·ªÉ c·∫£ d·ªØ li·ªáu gi·∫£)
                </p>
            </div>

            <div class="button-group">
                <button class="btn-success" onclick="verifyProof()">‚úÖ Ki·ªÉm Tra Proof</button>
                <button class="btn-danger" onclick="demoDetectModification()">‚ùå Thay ƒê·ªïi & Ki·ªÉm Tra (Demo)</button>
            </div>

            <div id="verifyStatus"></div>

            <div id="verifyResult"
                style="display: none; margin-top: 15px; border-top: 1px solid var(--color-border); padding-top: 15px;">
                <h3 style="font-size: 14px; margin-bottom: 10px;">üîç K·∫øt Qu·∫£ Ki·ªÉm Tra:</h3>
                <div id="verifyComparison"></div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>